---
# --- SDDM Theme & Config ---
- name: Configure SDDM Theme (Sugar Candy)
  file:
    path: /etc/sddm.conf.d
    state: directory
    mode: '0755'
  tags: [desktop, sddm]

- name: Set SDDM Theme
  copy:
    content: |
      [Theme]
      Current=catppuccin-mocha
    dest: /etc/sddm.conf.d/theme.conf
  tags: [desktop, sddm]

# --- Plymouth Theme (Removed by user request) ---

# --- Firefox Profile ---
- name: Create Firefox Profile Directory
  file:
    path: "{{ ansible_user_dir }}/.mozilla/firefox/catppuccin.default"
    state: directory
    owner: "{{ default_user }}"
    group: "{{ default_user }}"
    recurse: yes
  tags: [desktop, firefox]

# We should ideally copy the profile content here if it exists in the repo
# Since it's in the repo (assets?), we can synchronize it.
# Check if we have source profile files
# - synchronize: ...

# --- Spicetify ---
- name: Check if Spicetify is installed
  command: which spicetify
  register: spicetify_check
  ignore_errors: true
  changed_when: false
  tags: [desktop, spicetify]

- name: Check if Spotify is installed
  command: which spotify
  register: spotify_check
  ignore_errors: true
  changed_when: false
  tags: [desktop, spicetify]

- name: Set Spotify Permissions for Spicetify
  file:
    path: /opt/spotify
    mode: 'a+wr'
    recurse: yes
  when: 
    - spicetify_check.rc == 0
    - spotify_check.rc == 0
    - ansible_facts['os_family'] == 'Archlinux'
  ignore_errors: true
  tags: [desktop, spicetify]

- name: Apply Spicetify Theme (Catppuccin Mocha)
  shell: |
    spicetify config current_theme catppuccin
    spicetify config color_scheme mocha
    spicetify config inject_css 1 replace_colors 1 overwrite_assets 1
    spicetify backup apply
  become: no
  when: 
    - spicetify_check.rc == 0
    - spotify_check.rc == 0
  ignore_errors: yes
  tags: [desktop, spicetify]
  register: spicetify_theme
  changed_when: "'already backed up' not in spicetify_theme.stderr"

- include_tasks: assets.yml
  tags: [desktop, assets]
