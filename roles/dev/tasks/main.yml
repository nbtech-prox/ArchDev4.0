---
# --------------------------------------------------------
# Install Development Packages
# --------------------------------------------------------

- name: Install Developer Tools
  pacman:
    name: "{{ packages_dev_tools + packages_terminal }}"
    state: present
  become: yes
  tags: [dev, tools]

- name: Install Web Dev Stack (PHP/Laravel)
  pacman:
    name: "{{ packages_dev_web }}"
    state: present
  become: yes
  tags: [dev, web]

- name: Install Python Stack
  pacman:
    name: "{{ packages_dev_python }}"
    state: present
  become: yes
  tags: [dev, python]

# --------------------------------------------------------
# Docker Setup
# --------------------------------------------------------

- name: Add user to Docker group
  user:
    name: "{{ target_user }}"
    groups: docker
    append: yes
  become: yes
  tags: [dev, docker]

- name: Enable Docker Service
  systemd:
    name: docker
    enabled: yes
    state: started
  become: yes
  tags: [dev, docker]

# --------------------------------------------------------
# Include Subtasks
# --------------------------------------------------------

- include_tasks: php_laravel.yml
  tags: [dev, web]

- include_tasks: python.yml
  tags: [dev, python]

- include_tasks: docker_tuning.yml
  tags: [dev, docker]

- include_tasks: git_autosync.yml
  tags: [dev, git-autosync]

- include_tasks: pass_helper.yml
  tags: [dev, pass]

# --------------------------------------------------------
# Security & Helper Scripts
# --------------------------------------------------------

- name: Install backup keys helper script
  copy:
    src: backup-keys.sh
    dest: /usr/local/bin/archdev-backup-keys
    mode: '0755'
    owner: root
    group: root
  become: yes
  tags: [dev, security]

- name: Create backup keys notice
  copy:
    content: |
      ================================================
      üîê BACKUP DE CHAVES DE SEGURAN√áA
      ================================================
      
      Execute regularmente:
         archdev-backup-keys
      
      ================================================
    dest: "{{ target_home }}/.config/keys-backup-notice.txt"
    owner: "{{ target_user }}"
    group: "{{ target_user }}"
    mode: '0644'
  tags: [dev, security]

# --------------------------------------------------------
# MariaDB Setup
# --------------------------------------------------------

- name: Enable MariaDB Service
  systemd:
    name: mariadb
    enabled: yes
    state: started
  become: yes
  tags: [dev, mariadb]

- name: Install MariaDB setup helper
  copy:
    src: mariadb-setup.sh
    dest: /usr/local/bin/archdev-mariadb-setup
    mode: '0755'
    owner: root
    group: root
  become: yes
  tags: [dev, mariadb]

- name: Create MariaDB notice
  copy:
    content: |
      ================================================
      üóÑÔ∏è  Execute:
         sudo archdev-mariadb-setup
      ================================================
    dest: "{{ target_home }}/.config/mariadb-notice.txt"
    owner: "{{ target_user }}"
    group: "{{ target_user }}"
    mode: '0644'
  tags: [dev, mariadb]
