---
- name: Install Developer Tools
  pacman:
    name: "{{ packages_dev_tools + packages_terminal }}"
    state: present
  tags: [dev, tools]

- name: Install Web Dev Stack (PHP/Laravel)
  pacman:
    name: "{{ packages_dev_web }}"
    state: present
  tags: [dev, web]

- name: Install Python Stack
  pacman:
    name: "{{ packages_dev_python }}"
    state: present
  tags: [dev, python]

- name: Configure Docker
  user:
    name: "{{ default_user }}"
    groups: docker
    append: yes
  tags: [dev, docker]

- name: Enable Docker Service
  systemd:
    name: docker
    enabled: yes
    state: started
  tags: [dev, docker]

# Include sub-tasks
- include_tasks: php_laravel.yml
  tags: [dev, web]

- include_tasks: python.yml
  tags: [dev, python]

- include_tasks: git_autosync.yml
  tags: [dev, git-autosync]

- include_tasks: docker_helper.yml
  tags: [dev, docker]

- include_tasks: pass_helper.yml
  tags: [dev, pass]

- name: Copy MariaDB setup helper script
  copy:
    src: mariadb-setup.sh
    dest: /usr/local/bin/archdev-mariadb-setup
    mode: '0755'
    owner: root
    group: root
  tags: [dev, mariadb]

- name: Create post-install notice for MariaDB
  copy:
    content: |
      ================================================
      üóÑÔ∏è  MARIADB CONFIGURA√á√ÉO P√ìS-INSTALA√á√ÉO
      ================================================
      
      O MariaDB est√° instalado e ativo, mas PRECISA de 
      configura√ß√£o de seguran√ßa.
      
      Execute:
         sudo archdev-mariadb-setup
      
      Ou manualmente:
         sudo mariadb-secure-installation
      
      Responda:
         N - unix_socket auth
         Y - change root password
         Y - remove anonymous users  
         Y - disallow root login remotely
         Y - remove test database
         Y - reload privileges
      
      ================================================
    dest: "{{ ansible_user_dir }}/.config/archdev/mariadb-notice.txt"
    owner: "{{ default_user }}"
    group: "{{ default_user }}"
    mode: '0644'
  tags: [dev, mariadb]

- name: Display MariaDB notice
  debug:
    msg: |
      ================================================
      üóÑÔ∏è  MARIADB CONFIGURA√á√ÉO P√ìS-INSTALA√á√ÉO
      ================================================
      
      Execute para configurar: 
         sudo archdev-mariadb-setup
      
      Ou manualmente:
         sudo mariadb-secure-installation
      
      ================================================
