---
# --- Docker Helper Tasks ---
# Informa o usu√°rio sobre necessidade de logout/login

- name: Check if user is in docker group
  shell: "groups {{ target_user }} | grep -q docker"
  register: docker_group_check
  ignore_errors: true
  changed_when: false
  tags: [dev, docker]

- name: Create Docker post-install notice
  copy:
    content: |
      ================================================
      üê≥ DOCKER CONFIGURA√á√ÉO P√ìS-INSTALA√á√ÉO
      ================================================
      
      O seu utilizador foi adicionado ao grupo 'docker'.
      
      ‚ö†Ô∏è  IMPORTANTE: Fa√ßa logout e login novamente
         (ou reinicie o sistema) para usar Docker sem sudo.
      
      Ap√≥s o login, teste com:
         docker run hello-world
      
      ================================================
    dest: "{{ target_home }}/.config/docker-notice.txt"
    owner: "{{ target_user }}"
    group: "{{ target_user }}"
    mode: '0644'
  when: docker_group_check.rc == 0
  tags: [dev, docker]

- name: Display Docker notice
  debug:
    msg: |
      ================================================
      üê≥ DOCKER CONFIGURA√á√ÉO P√ìS-INSTALA√á√ÉO
      ================================================
      
      O seu utilizador foi adicionado ao grupo 'docker'.
      
      ‚ö†Ô∏è  IMPORTANTE: Fa√ßa logout e login novamente
         (ou reinicie o sistema) para usar Docker sem sudo.
      
      Ap√≥s o login, teste com:
         docker run hello-world
      
      ================================================
  when: docker_group_check.rc == 0
  tags: [dev, docker]
