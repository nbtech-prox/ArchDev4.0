---
# --- Dotfiles Configuration ---
- name: Ensure .config directory exists
  file:
    path: "{{ ansible_user_dir }}/.config"
    state: directory
    owner: "{{ default_user }}"
    group: "{{ default_user }}"
    mode: '0755'
  tags: [dotfiles, setup]

- name: Create local bin directory
  file:
    path: "{{ ansible_user_dir }}/.local/bin"
    state: directory
    owner: "{{ default_user }}"
    group: "{{ default_user }}"
    mode: '0755'
  tags: [dotfiles, setup]

- name: Sync Configuration Directories (Hyprland, Waybar, Kitty, etc.)
  synchronize:
    src: "{{ role_path }}/files/{{ item }}/"
    dest: "{{ ansible_user_dir }}/.config/{{ item }}/"
    recursive: yes
    delete: yes
    backup: yes
  loop:
    - hypr
    - waybar
    - kitty
    - dunst
    - rofi
    - wlogout
    - nvim
    - starship
  become: no
  tags: [dotfiles, config]
  # synchronize uses rsync, so ensure rsync is installed (base-devel/pacman)

- name: Sync Zsh Configuration
  synchronize:
    src: "{{ role_path }}/files/zsh/"
    dest: "{{ ansible_user_dir }}/.config/zsh/"
    recursive: yes
    delete: yes
    backup: yes
  become: no
  tags: [dotfiles, zsh]

- name: Link .zshrc
  file:
    src: "{{ ansible_user_dir }}/.config/zsh/.zshrc"
    dest: "{{ ansible_user_dir }}/.zshrc"
    state: link
    force: yes
  become: no
  tags: [dotfiles, zsh]

- name: Sync Scripts
  synchronize:
    src: "{{ role_path }}/files/scripts/"
    dest: "{{ ansible_user_dir }}/.local/bin/" # Assuming executed scripts; or keep in specific folder
    recursive: yes
    # delete: yes # Be careful deleting user's bin scripts
  become: no
  tags: [dotfiles, scripts]

- name: Make scripts executable
  shell: "chmod +x {{ ansible_user_dir }}/.local/bin/*"
  ignore_errors: yes
  tags: [dotfiles, scripts]
